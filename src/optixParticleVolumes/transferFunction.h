
#pragma once

#include <optixu/optixu_math_namespace.h>

inline __device__ float4 lerp4f(float4 a, float4 b, float c)
{
    return a * (1.f - c) + b * c;
}

inline __device__ float3 lerp3f(float3 a, float3 b, float c)
{
    return a * (1.f - c) + b * c;
}

inline __device__ float lerp1f(float a, float b, float c)
{
    return a * (1.f - c) + b * c;
}

inline __device__ float4 tf(float v, float t, const int tf_type)
{
const float wave[249][4] = {
{0, 0.775312158435526, 0.9514635197656437, 0.924352416290213}, 
{0.005025125628140704, 0.7599216982145388, 0.9437343675944847, 0.9207454451337328}, 
{0.010050251256281407, 0.7444490360423948, 0.9360134403360025, 0.9171364310190445}, 
{0.012623878568410874, 0.736490649122543, 0.9320623449958584, 0.9152872746635978}, 
{0.01507537688442211, 0.7284988712112728, 0.9277731922966133, 0.9142664190536769}, 
{0.020100502512562814, 0.7120206300416044, 0.918992893242344, 0.9121661399396372}, 
{0.02512562814070352, 0.695403116769279, 0.9102283850686996, 0.9100555231692241}, 
{0.025247757136821748, 0.6949974139599924, 0.9100155727780244, 0.9100040990386381}, 
{0.03015075376884422, 0.682586981811964, 0.8966801896954925, 0.9007266064616286}, 
{0.035175879396984924, 0.6698838558582999, 0.8830522702671058, 0.8912329572253412}, 
{0.04020100502512563, 0.6571967371900839, 0.869464840052792, 0.8817544887151381}, 
{0.04522613065326633, 0.6445249271744543, 0.85591827655675, 0.8722912619966338}, 
{0.05025125628140704, 0.6318676605941985, 0.8424129659064972, 0.8628433386187376}, 
{0.050495514273643495, 0.6312527808969398, 0.8417575668404127, 0.8623844912738694}, 
{0.05527638190954774, 0.6202357588500852, 0.8288150220819218, 0.8536745358899956}, 
{0.06030150753768844, 0.6086693586204303, 0.8152528344875687, 0.8445330111150805}, 
{0.06532663316582915, 0.597116177525046, 0.8017336969367238, 0.8354052972479008}, 
{0.07035175879396985, 0.5855755430308922, 0.7882580388983185, 0.8262914432611396}, 
{0.07537688442211056, 0.5740467201594199, 0.7748263003986126, 0.8171914984472572}, 
{0.07574327141046523, 0.5732065827618434, 0.773848708735517, 0.8165285576492697}, 
{0.08040201005025126, 0.5627262503806477, 0.7596794765784337, 0.8061971730832848}, 
{0.08542713567839195, 0.551443112123477, 0.7444507986767648, 0.7950765742007122}, 
{0.09045226130653267, 0.540181927990872, 0.7292797256626107, 0.7839802910230321}, 
{0.09547738693467336, 0.5289423785188305, 0.7141669236028818, 0.7729084642998449}, 
{0.10050251256281408, 0.5177241046074551, 0.6991130770149115, 0.7618612365085291}, 
{0.10099102854728699, 0.5166346437406756, 0.6976527924493695, 0.7607886010737518}, 
{0.10552763819095477, 0.5047505596332227, 0.682744724563859, 0.7501686505343281}, 
{0.11055276381909548, 0.4916061825634895, 0.6663020716748489, 0.7384306828003061}, 
{0.11557788944723618, 0.4784809044672143, 0.6499348082920834, 0.7267197425878325}, 
{0.12060301507537688, 0.4653731978869889, 0.6336440167038643, 0.7150359862707932}, 
{0.12562814070351758, 0.4522813391069685, 0.6174308175273585, 0.7033795721541679}, 
{0.12623878568410873, 0.45069142663688205, 0.6154659591518946, 0.7019649748001751}, 
{0.1306532663316583, 0.44142951360297744, 0.6038781995829164, 0.6930086679581733}, 
{0.135678391959799, 0.43090181968315816, 0.5907374233215121, 0.6828354877385189}, 
{0.1407035175879397, 0.42038975413351737, 0.5776504043598565, 0.6726859042014917}, 
{0.1457286432160804, 0.4098924282575688, 0.5646178277322828, 0.6625600646040176}, 
{0.15075376884422112, 0.39940884899039036, 0.5516403998585339, 0.6524581182428266}, 
{0.15148654282093046, 0.39787007033584126, 0.5497426692548452, 0.6509835360041035}, 
{0.15577889447236182, 0.3893772810386977, 0.5381893509778528, 0.642276807031056}, 
{0.16080402010050251, 0.3794307772473157, 0.5247084952734677, 0.6321018386279263}, 
{0.1658291457286432, 0.3694930830217073, 0.5112893720313707, 0.621950998739943}, 
{0.1708542713567839, 0.3595629398326948, 0.49793284587560366, 0.6118244369253752}, 
{0.17587939698492464, 0.34963894308491567, 0.48463981063061873, 0.6017223048643529}, 
{0.17673429995775222, 0.34794002581593453, 0.4823761092615591, 0.6000030911548827}, 
{0.18090452261306533, 0.3357647284050028, 0.46604425187979953, 0.589624841346276}, 
{0.18592964824120603, 0.3210225393567361, 0.4464864574317616, 0.5771378868086473}, 
{0.1893581785261631, 0.3109101463123343, 0.43321980021242595, 0.5686297955853554}, 
{0.19095477386934673, 0.30781929320006624, 0.42811061873491046, 0.5661546573463123}, 
{0.19597989949748745, 0.29797728515565247, 0.41206688790688906, 0.5583521507278341}, 
{0.20100502512562815, 0.28800936704167795, 0.3961159465621461, 0.5505437810744287}, 
{0.20198205709457398, 0.28604396365622065, 0.39301889970758125, 0.5490225393994388}, 
{0.20603015075376885, 0.2776322185357637, 0.3784341004301975, 0.5427497030366716}, 
{0.21105527638190955, 0.2669653679138958, 0.3604237136133372, 0.5349433001749173}, 
{0.21460593566298483, 0.25926472670618433, 0.3477613649418386, 0.5294142941155143}, 
{0.21608040201005024, 0.25625652319090536, 0.34297063543818646, 0.5271292851370853}, 
{0.22110552763819097, 0.2458223434169245, 0.326689287589126, 0.5193283618795906}, 
{0.22613065326633167, 0.23515438290577273, 0.3105083924433492, 0.5115176848942871}, 
{0.22722981423139574, 0.2327742249991797, 0.30697803844769767, 0.5098061182461489}, 
{0.23115577889447236, 0.22385324474681095, 0.2924494657098962, 0.5037265028900499}, 
{0.23618090452261306, 0.21203161527000142, 0.2739488592448102, 0.49592037937855066}, 
{0.2398536927998066, 0.2030721277617017, 0.2604939551817163, 0.49019791865067425}, 
{0.24120603015075376, 0.1989852377846953, 0.25487936532972605, 0.4868353197918563}, 
{0.24623115577889448, 0.183391146357865, 0.2341181495178008, 0.4743415541746889}, 
{0.25125628140703515, 0.16713845883141293, 0.21353324634821136, 0.46185901348232644}, 
{0.25247757136821747, 0.16305492029140237, 0.20855474020886705, 0.4588257400213464}, 
{0.2524875713682175,  0.267735707679481,   0.33945982745835707, 0.05260324173660145}, 
{0.2562814070351759, 0.27459420718699457, 0.3490667220285362, 0.057014620740078355}, 
{0.2613065326633166, 0.283716332504611, 0.36186183315087433, 0.06285990996065538}, 
{0.2663316582914573, 0.2928809438566286, 0.3747357051956292, 0.06871201255672416}, 
{0.271356783919598, 0.3020875336785766, 0.3876869242143244, 0.07457469652900764}, 
{0.2763819095477387, 0.31133560581109054, 0.4007141338480339, 0.08045096068681454}, 
{0.2772426960417306, 0.31292389441803126, 0.40295317742290043, 0.08145908853227249}, 
{0.2814070351758794, 0.31916804452244335, 0.41293795694061725, 0.086716485902634}, 
{0.2864321608040201, 0.32671700837368695, 0.42504281126859256, 0.09305764226125701}, 
{0.2914572864321608, 0.3342814478290245, 0.4372082513022322, 0.09939972526580798}, 
{0.2964824120603015, 0.3418613897213842, 0.4494333987079547, 0.1057463905938108}, 
{0.30150753768844224, 0.349456854726098, 0.46171740376003084, 0.11210064969137287}, 
{0.3019978207152437, 0.35019874806968754, 0.4629190293419359, 0.11272111515518607}, 
{0.3065326633165829, 0.3585427666611091, 0.4749808307902466, 0.11935287041642106}, 
{0.31155778894472363, 0.3678207914336373, 0.4884111419493328, 0.12670919930284621}, 
{0.3165829145728643, 0.3771320629040663, 0.5019082330431871, 0.1340768020674459}, 
{0.32160804020100503, 0.38647629117636056, 0.5154711273399937, 0.1414585003127696}, 
{0.32663316582914576, 0.39585319051420387, 0.5290988807753537, 0.14885662464225374}, 
{0.3267529453887568, 0.3960770958588734, 0.5294244975542682, 0.14903318435031288}, 
{0.3316582914572864, 0.4068655880197306, 0.5432829468783974, 0.15755713307747837}, 
{0.33668341708542715, 0.4179644768912512, 0.5575469222693435, 0.16629796809476263}, 
{0.3417085427135678, 0.42911035163078853, 0.5718778842848735, 0.17505153622540476}, 
{0.34673366834170855, 0.4403026785467298, 0.5862749049152964, 0.1838210751974525}, 
{0.3515080700622699, 0.45097913331767775, 0.600013977809036, 0.19217031509598173}, 
{0.35175879396984927, 0.45153064942146043, 0.6007215509764244, 0.19268636382227214}, 
{0.35678391959798994, 0.46260418678605814, 0.6149353846548165, 0.20302668860275547}, 
{0.36180904522613067, 0.47371523162461265, 0.6292102485508777, 0.21336643656222914}, 
{0.36683417085427134, 0.4848634939816417, 0.6435453680632247, 0.2237110913062152}, 
{0.37185929648241206, 0.49604868640226746, 0.6579399910905478, 0.23406522703549126}, 
{0.37626319473578307, 0.505881257326485, 0.6706034373122424, 0.24315017382427873}, 
{0.3768844221105528, 0.5071856952661007, 0.6718746422300593, 0.24481904764662366}, 
{0.38190954773869346, 0.5177380963348954, 0.6821730876449638, 0.2582580373408368}, 
{0.3869346733668342, 0.528292372324748, 0.6924992207421614, 0.2716042862374896}, 
{0.3919597989949749, 0.5388492049214487, 0.7028528472106945, 0.2848760887671821}, 
{0.3969849246231156, 0.5494092273665567, 0.7132337749768546, 0.2980885771748756}, 
{0.40101831940929616, 0.5578878895868392, 0.721585603138601, 0.3086592180017771}, 
{0.4020100502512563, 0.5600471758998197, 0.7234611340665832, 0.311840369688728}, 
{0.40703517587939697, 0.5709733851165937, 0.7329770481875046, 0.3278936220016291}, 
{0.4120603015075377, 0.581875622785818, 0.7425138650650367, 0.3438536615998081}, 
{0.4170854271356784, 0.5927551829281894, 0.7520714998764197, 0.35973990853846965}, 
{0.4221105527638191, 0.6036132768278298, 0.7616498667186459, 0.3755684926264473}, 
{0.42577344408280926, 0.6115150358183997, 0.7686446994059833, 0.3870776855839621}, 
{0.4271356783919598, 0.6139618442510818, 0.7709782496819118, 0.3908196456162653}, 
{0.4321608040201005, 0.6229780017825249, 0.7795975947269632, 0.4046093085657967}, 
{0.4371859296482412, 0.6319790907508874, 0.7882344169531714, 0.41838170034036876}, 
{0.44221105527638194, 0.6409656323715756, 0.7968886352002318, 0.43214243183722023}, 
{0.4472361809045226, 0.6499381243787187, 0.8055601684430433, 0.4458964044107198}, 
{0.45052856875632236, 0.6558093792893408, 0.8112509783728471, 0.45490622278026444}, 
{0.45226130653266333, 0.6601639717401672, 0.8145716534912317, 0.46118969712450414}, 
{0.457286432160804, 0.6727699476147799, 0.8242126197018069, 0.47940123997478695}, 
{0.4623115577889447, 0.6853434593252428, 0.8338694233435653, 0.4976033454664445}, 
{0.46733668341708545, 0.697886267088822, 0.8435420570951989, 0.5158041235127131}, 
{0.4723618090452261, 0.7104000144306151, 0.8532305108680813, 0.5340105204894983}, 
{0.4752836934298355, 0.7176634463587481, 0.8588711793820938, 0.5446017029476189}, 
{0.47738693467336685, 0.7236089226485338, 0.8624658758447559, 0.5556019628191577}, 
{0.4824120603015075, 0.7377102374101294, 0.8710571171291848, 0.581850762000934}, 
{0.48743718592964824, 0.7516690137763244, 0.8796523549621544, 0.6080701624934733}, 
{0.48766125576659203, 0.7522881855551512, 0.8800357127884089, 0.6092389058798946}, 
{0.49246231155778897, 0.7736962203096219, 0.8908554468370452, 0.6278622955146241}, 
{0.49748743718592964, 0.7960869125457797, 0.9021708521338254, 0.6474110512988959}, 
{0.5000388181033486, 0.8074508377519238, 0.9079124138410075, 0.657358915800978}, 
{0.5000488181033486, 0.9276357433493417, 0.9139978035565667, 0.6749259513839898}, 
{0.5025125628140703, 0.9269745450884003, 0.9115592843803729, 0.667153570926665}, 
{0.507537688442211, 0.9255531005999141, 0.9065943563424594, 0.6512941083877981}, 
{0.5125628140703518, 0.9240350061961958, 0.9016411747957027, 0.6354225862961846}, 
{0.5175879396984925, 0.9224215748807638, 0.8966997483570028, 0.6195349308939132}, 
{0.5226130653266332, 0.9207140931181195, 0.8917700844424011, 0.6036266062665865}, 
{0.5254803406404335, 0.9196981681578138, 0.8889625513798035, 0.5945383289950154}, 
{0.5276381909547738, 0.9188782902028004, 0.8862412168620253, 0.5882593217422338}, 
{0.5326633165829145, 0.9169120640686073, 0.8799127707934077, 0.5736295043408587}, 
{0.5376884422110553, 0.9148669606134863, 0.8735968130506899, 0.5589861759071701}, 
{0.542713567839196, 0.9127439160971961, 0.8672933844075653, 0.5443252199024157}, 
{0.5477386934673367, 0.9105438528672115, 0.8610025251922214, 0.5296420361858138}, 
{0.5509118631775183, 0.9091153381482912, 0.8570365869322544, 0.520356428599813}, 
{0.5527638190954774, 0.9085162814208363, 0.8552851770801577, 0.5159510490330583}, 
{0.5577889447236181, 0.9068562167499106, 0.8505382420837672, 0.5039799070475616}, 
{0.5628140703517588, 0.9051460281826504, 0.8457991635639738, 0.4919802424288419}, 
{0.5678391959798995, 0.9033862233269233, 0.8410679570862959, 0.4799480261597259}, 
{0.5728643216080402, 0.9015773046794293, 0.8363446378808307, 0.4678787944902523}, 
{0.5763433857146032, 0.9002964187654288, 0.8330791529859574, 0.4594985880382367}, 
{0.577889447236181, 0.8993617330088386, 0.8308982466211827, 0.4560005769398014}, 
{0.5829145728643216, 0.896296415715676, 0.8238170576211347, 0.444620766862611}, 
{0.5879396984924623, 0.8931895118058437, 0.8167471481565016, 0.4332226945952099}, 
{0.592964824120603, 0.8900412998321293, 0.8096885533647028, 0.4218028219679161}, 
{0.5979899497487438, 0.8868520574737382, 0.8026413081215752, 0.4103572064108727}, 
{0.6017749082516881, 0.8844229756234473, 0.7973407901535211, 0.40171664393522427}, 
{0.6030150753768845, 0.8834115800805734, 0.7954457768792172, 0.39891311627570303}, 
{0.6080402010050251, 0.8792915930932611, 0.7877756494743098, 0.38753672909795195}, 
{0.6130653266331658, 0.8751367000225656, 0.7801190642621044, 0.3761301961855279}, 
{0.6180904522613065, 0.8709470680865472, 0.7724760725516102, 0.3646882539966473}, 
{0.6231155778894473, 0.8667228657452846, 0.7648467254936374, 0.35320495005193436}, 
{0.6272064307887729, 0.8632586189855193, 0.758645939274581, 0.343821431274201}, 
{0.628140703517588, 0.8626852046667925, 0.75724054073617, 0.34257314223085716}, 
{0.6331658291457286, 0.8595882665577963, 0.7496861780060377, 0.33585992823012595}, 
{0.6381909547738693, 0.8564698676710034, 0.7421398470286622, 0.329147753174075}, 
{0.6432160804020101, 0.8533300493904556, 0.7346014965381213, 0.32243592750274014}, 
{0.6482412060301508, 0.850168852668316, 0.7270710718732115, 0.31572370301070224}, 
{0.6526379533258578, 0.8473854512862493, 0.7204887618440295, 0.3098498596613534}, 
{0.6532663316582915, 0.8470431881339512, 0.7195646841977065, 0.3091489030079325}, 
{0.6582914572864321, 0.8442944914154541, 0.7121781188309837, 0.30354560483604576}, 
{0.6633165829145728, 0.8415251543631657, 0.7047972760355724, 0.2979460497104522}, 
{0.6683417085427136, 0.8387352173383295, 0.6974220483832677, 0.2923498943308946}, 
{0.6733668341708543, 0.8359247201029217, 0.690052322767046, 0.2867567682011554}, 
{0.6780694758629426, 0.8332759959114721, 0.6831604224139437, 0.2815249666933472}, 
{0.678391959798995, 0.8330983614657309, 0.68279768948539, 0.2812749579445606}, 
{0.6834170854271356, 0.8303261193546838, 0.6771476940021428, 0.2773808420708211}, 
{0.6884422110552764, 0.827545900404132, 0.6715020205131674, 0.2734897825175933}, 
{0.6934673366834171, 0.8247576994522563, 0.6658606326541264, 0.2696016806452905}, 
{0.6984924623115578, 0.8219615112382619, 0.660223492355624, 0.2657164317379909}, 
{0.7035009984000276, 0.8191666010520049, 0.6546091489968668, 0.2618467376135723}, 
{0.7035175879396985, 0.8191552556554813, 0.654582077307362, 0.26183247057408815}, 
{0.7085427135678392, 0.8157090500788865, 0.6463845982515539, 0.2575157633899413}, 
{0.7135678391959799, 0.8122437485302071, 0.6381925192194399, 0.2532088805071102}, 
{0.7185929648241206, 0.8087593508074384, 0.630005596380892, 0.2489118721419421}, 
{0.7236180904522613, 0.8052558560356552, 0.6218235712506058, 0.24462478857660447}, 
{0.7286432160804021, 0.8017332626667816, 0.6136461697232354, 0.24034768012089752}, 
{0.7289325209371125, 0.8015298796329651, 0.6131755178606706, 0.24010174458279238}, 
{0.7336683417085427, 0.7999745435710501, 0.607203797766147, 0.2361993162476807}, 
{0.7386934673366834, 0.7983047882843529, 0.600865838070344, 0.23206153464494522}, 
{0.7437185929648241, 0.796615122641838, 0.5945261518096796, 0.2279267100303522}, 
{0.7487437185929648, 0.7949056178137953, 0.5881844740081958, 0.2237946524191487}, 
{0.75, 0.7944751499902131, 0.5865987111734031, 0.22276204679154699}, 
{0.7537688442211056, 0.7149317918589531, 0.37781670859621297, 0.2002602240413991}, 
{0.7543740434741975, 0.7010010018773919, 0.34281320832603346, 0.19600274810683183}, 
{0.7587939698492463, 0.7073493469845317, 0.3413476601941019, 0.19686297918737383}, 
{0.7638190954773869, 0.7145654057515248, 0.3396271824005922, 0.19784390077052366}, 
{0.7666553413004875, 0.7186376205988665, 0.33863012699799416, 0.19839890461117432}, 
{0.7688442211055276, 0.7211511937175136, 0.3401770170658534, 0.20093845137752514}, 
{0.7738693467336684, 0.7269235726748136, 0.34373339099949546, 0.20676384860521024}, 
{0.7788944723618091, 0.7326985073609984, 0.34729683482048435, 0.2125837722524675}, 
{0.7789366391267777, 0.7327469767102908, 0.34732676614166935, 0.21263258900849863}, 
{0.7839195979899498, 0.7366933605571901, 0.34969633854439897, 0.21892228780814393}, 
{0.7889447236180904, 0.7406676614691554, 0.35209064298522935, 0.22524513682437447}, 
{0.7939698492462312, 0.7446364423767271, 0.3544896331269438, 0.23155028465795408}, 
{0.7989949748743719, 0.7485996852854836, 0.3568932945212068, 0.23783995094138966}, 
{0.8034992347793579, 0.7521474083174788, 0.3590517690465218, 0.24346616973396756}, 
{0.8040201005025126, 0.7527102212891816, 0.3595578774173432, 0.24423632695956682}, 
{0.8090452261306533, 0.7581360022482331, 0.3644445150853102, 0.2516670132153722}, 
{0.8140703517587939, 0.7635544646164488, 0.3693382278463507, 0.25909965571290955}, 
{0.8190954773869347, 0.7689656046147418, 0.37423906040776056, 0.26653566005836304}, 
{0.8241206030150754, 0.7743694199054905, 0.3791470535563516, 0.2739762822269347}, 
{0.8280618304319382, 0.778602529321642, 0.3830014480905978, 0.2798159593338788}, 
{0.8291457286432161, 0.7797584044788121, 0.3855510402291443, 0.2824330370390361}, 
{0.8341708542713568, 0.7850709931173099, 0.3973363467077853, 0.294591946091097}, 
{0.8391959798994975, 0.7903071087490513, 0.40906923497881514, 0.30679427434858186}, 
{0.8442211055276382, 0.795466194397072, 0.4207560730816839, 0.319041288242609}, 
{0.8492462311557789, 0.8005476929739327, 0.4324025221175249, 0.33133400270483004}, 
{0.8526244260845184, 0.8039198943064317, 0.44021182202061804, 0.33962401143328497}, 
{0.8542713567839196, 0.8060954237638523, 0.44355494080248176, 0.3432684213919367}, 
{0.8592964824120604, 0.8127069945870342, 0.4537544306930667, 0.3544146926575942}, 
{0.864321608040201, 0.8192787541429715, 0.46395353896328256, 0.36560097191348834}, 
{0.8693467336683417, 0.8258106831366053, 0.474153707461018, 0.37682746083964336}, 
{0.8743718592964824, 0.832302763870811, 0.4843562510287041, 0.3880942951915029}, 
{0.8771870217370987, 0.8359223189280314, 0.4900733828258967, 0.39442383477276116}, 
{0.8793969849246231, 0.8385105337203009, 0.49467568211919105, 0.39955734905388496}, 
{0.8844221105527639, 0.8443595864790827, 0.5051405793522701, 0.41126039411089754}, 
{0.8894472361809045, 0.8501583085962999, 0.5156064916341602, 0.42300542390716606}, 
{0.8944723618090452, 0.8559065769991955, 0.5260746446541099, 0.43479243877853063}, 
{0.8994974874371859, 0.8616042686004802, 0.5365461625912648, 0.4466213997672884}, 
{0.901749617389679, 0.8641413793652388, 0.5412405916867432, 0.45193642493820557}, 
{0.9045226130653267, 0.8672088410098564, 0.547241112247011, 0.4592930241699544}, 
{0.9095477386934674, 0.8727154830611374, 0.5581198861302026, 0.4726614047869924}, 
{0.914572864321608, 0.8781547049592485, 0.5690057178040357, 0.48607756849310474}, 
{0.9195979899497487, 0.8835261903045859, 0.5798994997537895, 0.49954156406738454}, 
{0.9246231155778895, 0.8888296203377476, 0.590802051716894, 0.513053389392202}, 
{0.9263122130422592, 0.8905969259332799, 0.5944688337517035, 0.5176058581979777}, 
{0.9296482412060302, 0.8927975724968389, 0.5985640602093328, 0.5240433397176967}, 
{0.9346733668341709, 0.8960860223750675, 0.6047385835665956, 0.5337559050410147}, 
{0.9396984924623115, 0.8993425801994471, 0.6109201203375513, 0.5434874573791693}, 
{0.9447236180904522, 0.9025671044069267, 0.6171087118224051, 0.553238162780454}, 
{0.949748743718593, 0.905759452898934, 0.6233043965520294, 0.5630081675566738}, 
{0.9508748086948395, 0.9064703890454516, 0.6246937450697415, 0.565200158240812}, 
{0.9547738693467337, 0.9121783487323234, 0.6349769502222329, 0.5770276938511502}, 
{0.9597989949748744, 0.9194744142069166, 0.6482493141713994, 0.5923276467112666}, 
{0.964824120603015, 0.9267024354247444, 0.6615440526794273, 0.6076907789266073}, 
{0.9698492462311558, 0.933862355609079, 0.6748617623444315, 0.6231165124402642}, 
{0.9748743718592965, 0.9409541137970171, 0.6882029797960729, 0.6386042707914646}, 
{0.9754374043474198, 0.9417444497386949, 0.6896992621816821, 0.6403434117711959}, 
{0.9798994974874372, 0.9489294376750678, 0.7057168227760366, 0.661675276236788}, 
{0.9849246231155779, 0.9568353235086987, 0.7237979301690765, 0.6858217137538085}, 
{0.9877187021737098, 0.9611454788166734, 0.7338712026263011, 0.6993036088725813}, 
{0.9899497487437187, 0.9655456395361594, 0.7476950359541458, 0.7145051866359804}, 
{0.9949748743718593, 0.9750765377433036, 0.7788780180380828, 0.7489496661024287}, 
{1, 0.9840742890256217, 0.8101333302538569, 0.7836729718577742}
};
  float4 color;

  if (tf_type == 1)
  {
    if (v < .5f)
      color = lerp4f( make_float4(1,1,0,0), make_float4(1,1,1,0.5f), v * 2.f);
    else
      color = lerp4f( make_float4(1,1,1,0.5f), make_float4(1,0,0,1), v * 2.f - 1.f);
  }
  else if (tf_type == 2)
  {
    float3 rgb; 
    
    int i;
    for (i = 0; i < 248; i++){
        if (v > wave[i][0] && v <= wave[i+1][0]){
            break;
        }
    }
    rgb = lerp3f( make_float3(wave[i][1], wave[i][2], wave[i][3]), make_float3(wave[i+1][1], wave[i+1][2], wave[i+1][3]), (v - wave[i][0]) / (wave[i+1][0] - wave[i][0]) );
    // printf("%f %d %f %f %f %f\n", v, i, rgb.x, rgb.y, rgb.z, (v - wave[i][0]) / (wave[i+1][0] - wave[i][0]));
    
    float a;
    if (v < .5f)
      a = lerp1f( 0.05f, 0.5f, v * 2.f);
    else
      a = lerp1f( 0.5f, 1.0f, v * 2.f - 1.f);
      
     color = make_float4(rgb.x, rgb.y, rgb.z, a);
    // if (v < .5f)
    //   color = lerp4f( make_float4(0,0,1,0.05f), make_float4(1,1,1,0.5f), v * 2.f);
    // else
    //   color = lerp4f( make_float4(1,1,1,0.5f), make_float4(1,0,0,1), v * 2.f - 1.f);
  }
  else if (tf_type == 3)
  {
    if (v < .33f)
      color = lerp4f( make_float4(1.f,0.f,1.f,0.05f), make_float4(0.f,0.f,1.f,0.33f), (v-0.f) * 3.f);
    else if (v < .66f)
      color = lerp4f( make_float4(0.f,0.f,1.f,.33f), make_float4(0.f,1.f,1.f,0.66f), (v-0.33f) * 3.f);
    else
      color = lerp4f( make_float4(0.f,1.f,0.f,0.5f), make_float4(1.f,1.f,1.f,1.f), (v-0.66f) * 3.f);
  }
  else
  {
    color = lerp4f( make_float4(0,0,1,0), make_float4(1,0,0,1), v);
  }

  //redshift
#if 1
  if (t > 0.f)
  {
    const float alpha = color.w;
    const float r = 1.f - expf(-t);
    if (r < .5f)
      color = lerp4f( make_float4(1,1,1,0), color, r * 2.f);
    else
      color = lerp4f( color, make_float4(1,0,0,1), r * 2.f - 1.f);
    color.w = alpha;
  }
#endif

  return color;

}
